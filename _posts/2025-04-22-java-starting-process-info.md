---
title: 자바 프로그램이 실행되는 흐름
description:
author: Choi Seon Ha
date: 2025-04-22 09:30:00 +0800
categories: [Development, Backend]
tags: [Java, backend]
pin: true
math: false
mermaid: fasle
---

우리가 작성한 `.java` 파일은 JDK에 포함된 **javac(java compiler)**를 통해 컴파일됩니다. 이 과정에서 **JVM이 이해할 수 있는 바이트 코드로 변환**되어 `.class` 파일이 생성됩니다.

이후부터는 JVM이 담당하는데요,

먼저 **클래스 로더(Class Loader)**가 **바이트 코드를 JVM 메모리에 동적으로 로드**합니다.

로드된 바이트 코드는 Method Area에 저장되며, 이때 로딩(Loading), 링킹(Linking), 초기화(Initialization) 단계를 거칩니다.

- Loading: 클래스 로더가 `.class` 파일을 읽어 JVM 메모리에 로드하는 단계. 로드된 클래스는 Method Area에 저장됩니다.
- Linking: 로드된 클래스가 실행될 수 있도록 준비하는 단계이며 세 가지의 과정으로 이루어집니다.
  - Verification : `.class`파일이 구조적으로 올바른지 확인
  - Preparation : static 변수를 메모리에 할당하고 기본값으로 초기화
  - Resolution : 런타임 상수 풀에 있는 심볼릭 레퍼런스를 실제 메모리 레퍼런스로 교체
- Initialization : static 변수를 사용자가 지정한 값으로 초기화하고 static 블록을 실행하는 단계

그 다음, **실행 엔진(Execution Engine)**이 로드된 바이트 코드를 실행합니다. 하지만 바이트 코드는 컴퓨터가 읽을 수 없기 때문에 **인터프리터(Interpreter)**와 **JIT 컴파일러(Just-in-Time Compiler)** 를 함께 사용하여 기계어로 변환합니다.

**인터프리터는 바이트 코드를 한 줄씩 읽어서 실행하는 방식**이고, **JIT 컴파일러는 자주 실행되는 메서드(Hotspot)를 감지하면 해당 메서드 전체를 네이티브 코드로 변환하여 캐싱합니다.**

### 클래스 로더가 바이트 코드를 동적으로 로드한다는 것은 무슨 의미인가요?

프로그램이 시작될 때 모든 클래스를 한꺼번에 로드하는 것이 아니라, **런타임 시점에 필요한 클래스만 로드하는 것을 의미합니다.**

**클래스 로드는 인스턴스를 생성할 때, static 메서드나 변수를 사용할 때, static 변수에 값을 할당할 때 이루어집니다**. 이러한 동적 로드 방식은 불필요한 클래스 로드를 방지하여 메모리를 효율적으로 사용할 수 있습니다.

### 실행 엔진이 바이트 코드를 기계어로 변환할 때 인터프리터와 JIT 컴파일러를 함께 사용하는 이유는 무엇인가요?

**인터프리터는 바이트 코드를 한 줄씩 읽어서 실행하는 방식**이기 때문에 초기 실행 속도가 빠릅니다. 하지만 같은 코드가 반복적으로 실행될 경우 매번 해석해야 해서 성능이 저하되는 단점이 있습니다. 초기 JVM은 인터프리터만 사용했지만, 이러한 단점을 보완하기 위해 JIT 컴파일러가 도입되었습니다.

**JIT 컴파일러는 자주 실행되는 메서드를 네이티브 코드로 변환하여 캐싱합니다.** 이렇게 변환된 코드는 반복 실행 시 인터프리터보다 훨씬 빠르게 실행됩니다. 하지만 JIT 컴파일 과정 자체에 시간이 소요되기 때문에 초기 실행 시 오버헤드가 발생할 수 있습니다. 따라서 JVM은 두 방식을 함께 사용하여 초기 실행 속도와 높은 반복 실행 성능을 동시에 달성할 수 있습니다.

> **네이티브 코드란, 운영체제가 바로 실행할 수 있는 기계어(바이너리 코드)를 의미합니다**

### 정리

1. .java 파일 → (컴파일러) → .class 파일 (바이트코드)
2. 바이트코드 → (JVM이 읽어서 실행: 인터프리터 or JIT 컴파일러) → 네이티브 코드

자바는 처음부터 네이티브 코드로 바꾸지 않고 중간 형태인 바이트코드를 만든 뒤,

처음엔 느리지만 유연한 인터프리터 방식으로 실행하다가, 자주 실행되는 코드는 JIT 컴파일러가 네이티브 코드로 변환해서 빠르게 실행합니다.

---

### JIT가 “자주 실행되는 코드”를 판단하는 기준은?

JVM에서는 이것을 HotSpot(핫스팟)이라고 부릅니다.

많이 호출되거나 오래 실행된 메서드나 루프를 “핫스팟” 이라고 보고 JIT 컴파일 대상이 됩니다.

JVM은 내부적으로 **카운터**를 사용해서 코드 실행 횟수를 기록합니다.

1. 메서드 호출 횟수: 어떤 메서드가 특정 횟수 이상 호출되면 핫스팟으로 간주
2. 루프 반복 횟수: 루프 안의 바이트코드가 특정 횟수 이상 반복되면 핫스팟 간주

JDK 11 이후부터는 단순한 호출 횟수만 보는 것이 아니라

- 성능 프로파일링 (성능 병목 감지)
- 인라이닝 판단 (다른 메서드 안에 집어넣기 적절한지)
- branch prediction(분기 예측), code path 최적화 등도 고려해서 판단합니다.
